<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Bacalaureat - Elev</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root { --bg-color: #f8fafc; --card-bg: #ffffff; --primary: #4f46e5; --success: #10b981; --accent: #f1f5f9; --text-main: #1e293b; --text-muted: #64748b; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 800px; background: var(--card-bg); padding: 30px; border-radius: 20px; shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .progress-bar-bg { height: 10px; background: var(--accent); border-radius: 10px; margin: 20px 0; overflow: hidden; }
        #progress-fill { height: 100%; width: 0%; background: var(--success); transition: width 0.4s; }
        .content-area { font-family: 'Merriweather', serif; line-height: 2; font-size: 1.2rem; }
        .blank-input { border: none; border-bottom: 2px solid #cbd5e1; background: #f8fafc; width: 140px; text-align: center; font-weight: 600; color: var(--primary); outline: none; }
        .blank-input.is-correct { border-bottom-color: var(--success); background-color: #f0fdf4; }
        .header-info { text-align: center; margin-bottom: 20px; }
        #student-tag { font-weight: 600; color: var(--primary); }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header-info">
        <h2 style="margin:0">Atelier de Literatură</h2>
        <div id="student-tag">Elev: Se încarcă...</div>
    </div>

    <div class="progress-bar-bg"><div id="progress-fill"></div></div>

    <div id="content" class="content-area"></div>
    
    <div style="text-align:center; margin-top:30px;">
        <button class="blank-input" style="width:200px; cursor:pointer;" onclick="location.reload()">Resetează Testul</button>
    </div>
</div>

<script>
    // CONFIGURATIA TA FIREBASE
    const firebaseConfig = {
        apiKey: "AIzaSyC2xOfKBy7FdA6uIyM0ij5ryHTop0yL3pg",
        authDomain: "bacromana-6f3eb.firebaseapp.com",
        databaseURL: "https://bacromana-6f3eb-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "bacromana-6f3eb",
        storageBucket: "bacromana-6f3eb.firebasestorage.app",
        messagingSenderId: "1087294677634",
        appId: "1:1087294677634:web:d92bf75a8b58f7b351ca9b"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const rawText = `Publicata in anul 1884, comedia [O scrisoare pierduta] de I.L. Caragiale apartine realismului [clasic]. Tema centrala este degradarea vietii [politice], sociale si de familie. Actiunea se desfasoara in capitala unui judet de munte, pe fondul agitatiei alegerilor pentru [parlament]. Conflictul principal consta in confruntarea a doua grupari politice: cea condusa de Stefan Tipatescu si [Zaharia Trahanache], respectiv gruparea ambitiosului avocat [Nae Catavencu].`;

    let correctAnswers = [];
    let studentName = prompt("Introdu numele tău:") || "Elev Anonim";
    document.getElementById('student-tag').innerText = "Elev: " + studentName;

    function init() {
        const container = document.getElementById('content');
        let i = 0;
        const formattedText = rawText.replace(/\[(.*?)\]/g, (match, word) => {
            correctAnswers.push(word.trim());
            return `<input type="text" class="blank-input" data-index="${i++}" oninput="updateProgress()">`;
        });
        container.innerHTML = formattedText.replace(/\n/g, '<br>');
    }

    function updateProgress() {
        const inputs = document.querySelectorAll('.blank-input');
        let correctCount = 0;

        inputs.forEach((input, idx) => {
            if (input.value.trim().toLowerCase() === correctAnswers[idx].toLowerCase()) {
                correctCount++;
                input.classList.add('is-correct');
            } else {
                input.classList.remove('is-correct');
            }
        });
        
        const percent = Math.round((correctCount / correctAnswers.length) * 100);
        document.getElementById('progress-fill').style.width = percent + "%";

        // Trimitere date la Firebase
        database.ref('clasa/' + studentName).set({
            nume: studentName,
            progres: percent,
            scor: correctCount + "/" + correctAnswers.length,
            ultimaActualizare: Date.now()
        });
    }

    init();
</script>
</body>
</html>