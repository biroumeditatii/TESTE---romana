<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Atelier de Literatura - Bacalaureat</title>
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#4f46e5">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --primary: #4f46e5;
            --text-main: #1e293b;
            --success: #10b981;
            --accent: #f1f5f9;
        }

        * { box-sizing: border-box; transition: all 0.2s ease; }

        html, body { 
            overscroll-behavior: none; 
            user-select: none; -webkit-user-select: none;
            background-color: var(--bg-color); 
            font-family: 'Inter', sans-serif;
            margin: 0; padding: 20px;
            display: flex; justify-content: center;
        }

        .app-container {
            width: 100%;
            max-width: 900px;
            background: var(--card-bg);
            padding: 40px;
            border-radius: 24px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 1px solid var(--accent);
            padding-bottom: 20px;
        }

        h1 { font-size: 1.8rem; color: var(--primary); margin: 0; }

        #student-name-display {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
            display: block;
        }

        .progress-container {
            margin-bottom: 30px;
            display: flex;
            align-items: center; gap: 15px;
        }

        .progress-bar-bg {
            flex-grow: 1; height: 12px;
            background: var(--accent);
            border-radius: 10px; overflow: hidden;
        }

        #progress-fill {
            height: 100%; width: 0%;
            background-color: #ef4444; 
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .content-area {
            font-family: 'Merriweather', serif;
            line-height: 2.2; font-size: 1.2rem;
            color: #334155; text-align: justify;
        }

        .blank-input {
            font-family: 'Inter', sans-serif;
            border: none; border-bottom: 2px solid #cbd5e1;
            background-color: #f8fafc;
            padding: 2px 8px; font-size: 1.1rem;
            font-weight: 600; color: var(--primary);
            width: 160px; outline: none; text-align: center;
            border-radius: 4px;
        }

        .input-number {
            font-family: 'Inter', sans-serif;
            font-size: 0.75rem;
            font-weight: 700;
            color: #94a3b8;
            margin-right: 2px;
            vertical-align: super;
        }

        .actions {
            margin-top: 50px;
            display: flex; justify-content: center; gap: 15px;
        }

        .btn {
            padding: 14px 28px; border-radius: 12px;
            font-size: 1rem; font-weight: 600;
            cursor: pointer; border: none;
        }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-secondary { background-color: var(--accent); color: #64748b; }

        #score-display {
            text-align: center; margin-top: 20px;
            font-size: 1.2rem; font-weight: 700; color: var(--success);
            display: none;
        }

        h3, b { color: var(--primary); display: block; margin-top: 30px; font-size: 1.5rem; border-bottom: 2px solid var(--accent); padding-bottom: 5px; }
    </style>
</head>
<body onload="init()">

<div class="app-container">
    <header>
        <h1>Evaluare: Povestea lui Harap-Alb</h1>
        <span id="student-name-display">Elev: Se încarcă...</span>
    </header>

    <div class="progress-container">
        <div class="progress-bar-bg"><div id="progress-fill"></div></div>
        <span id="progress-text" style="font-size: 0.9rem; font-weight: 600;">0%</span>
    </div>

    <div id="content" class="content-area"></div>
    <div id="score-display"></div>

    <div class="actions">
        <button class="btn btn-primary" onclick="finalCheck()">Finalizează Testul</button>
        <button class="btn btn-secondary" onclick="resetTest()">Resetează</button>
    </div>
</div>

<script>
    let studentName = localStorage.getItem('elev_nume');
    if (!studentName) { window.location.href = 'index.html'; }

    const firebaseConfig = {
      apiKey: "AIzaSyC2xOfKBy7FdA6uIyM0ij5ryHTop0yL3pg",
      authDomain: "bacromana-6f3eb.firebaseapp.com",
      databaseURL: "https://bacromana-6f3eb-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "bacromana-6f3eb",
      storageBucket: "bacromana-6f3eb.firebasestorage.app",
      messagingSenderId: "1087294677634",
      appId: "1:1087294677634:web:d92bf75a8b58f7b351ca9b"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    document.getElementById('student-name-display').innerText = "Elev: " + studentName;

    const rawText = `<b>Introducere</b>
Destinul şi [modernizarea] literaturii române au fost marcate în [perioada Marilor Clasici] de personalitatea lui [Titu Maiorescu]. Denumirea are atât semnificația de [adepți ai clasicismului], dar şi de [modele], căci adoptând acest program estetic, reprezentanții epocii devin [repere].

<b>Reper 1</b>
Textul aparţine [clasei de opere] care utilizează [narațiunea]. Construit pe [schema opoziţionalã Bine-Rãu] „Povestea lui Harap-Alb", [publicat în 1877] în [Convorbiri literare], are un subiect simplu, linear, organizat pe baza unui [tipar arhicunoscut]. Numeroasele motive sugerează magicul și perfecțiunea: [cifra trei, superioritatea mezinului, cãlãtoria primejdioasã, probele, lupta finalã, recompensa, nunta]. 

[Coordonata realist-psihologică] reorganizează acest tipar şi prezintă [maturizarea protagonistului], accentuând [dimensiunea sufletească] a celui care luptă pentru apărarea unor valori morale ca [adevărul, dreptatea, frumosul, iubirea]. [Originalitatea textului] este observabilă și la [nivelul limbajului] dominat [de oralitate, de fraze rimate, de umor]. Pornind de la opinia critică a lui [Alexandru Piru].

<b>Reper 2</b>
Dominanta tematică se configurează pe două dimensiuni: cea [populară, eterna luptă dintre Bine și Rău] şi cea cultă, [formarea personalității celui care polarizează interesul epic]. 

O secvenţă narativă relevantă pentru această tema complexă o constituie [coborârea în fântânã, ad inferos], reprezentând [începutul maturizãrii eroului]. Scena echivalează cu [un botez], căci prin apă fiul craiului primeşte [un alt nume şi o nouă identitate, un nou statut social]. Pentru erou, acesta este [punctul cel mai de jos în care l-a dus lipsa de experinţă]. [Mircea Eliade] considera coborârea în Infern [echivalentă cu decapitarea protagonistului, moartea iniţiatică]. Această secvență reflectă primul stadiu al existenței mezinului: [cel de novice/ începător]. El devine [rob], pentru că nu [distinge clar valoarea de nonvaloare], pentru că trebuie să parcurgă [chinul suferinței „negre” până va deveni un stăpânitor matur și responsabil].

Se remarcă și un al doilea episod semnificativ care conturează personalitatea tânărului și pune în lumina cealaltă componentă a tematicii, [Răul învins de Bine]. Ca într-o [piesă de teatru], fata dezvăluie adevărata identitate a Spânului, acesta retează capul lui Harap-Alb, acuzându-l de încălcarea jurământului. Calul îl ucide pe Spân, aruncându-l din înaltul cerului, în vreme ce fata de împărat îl readuce la viață pe fiul craiului cu ajutorul obiectelor magice, [smicelele de măr dulce, apa vie şi apa moartă].

<b>Reper 3</b>
Un element de structură esențial este [titlul nominal de tip analitic ce promite lectorului o „poveste” deosebită a maturizării] tânărului crai, un destin unicizat la nivel gramatical prin [substantivul articulat „povestea”]. 

Construcția [oximoronică] „Harap-Alb“ indică [statutul] de slugă naivă, [puritatea celui aflat la început de drum]. În aceeaşi măsură este o sugestie a coexistenţei [Binelui și a Răului].

Formula inițială și cea finală, aflate într-un raport de [complementaritate], [înrămează lumea] pe care o comunică povestitorul, pregătind ascultătorul [să intre în atmosfera de basm]. [Incipitul] conturează [cronotopul] specific poveştii ce debutează [ex abrupto] cu sintagma [„Amu cicã era odatã într-o țară”]. Indicele spațial [„într-o țară”] se combină cu cel temporal [„odată”] plasând evenimentele [într-un trecut nedeterminat, illo tempore]. Regionalismele [„amu”, „cică”] localizează întâmplările fantastice în lumea [humuleșteană a scriitorului]. 

Basmul are o [dublă ieșire]: primul tip [de final, deznodământul prezintă proba supremă, moartea și învierea], prin care eroul își redobândeşte condiția de împărat și este răsplătit cu o nuntă eternă. Al doilea final, [evocat prin ultima frază „Iar pe la noi, cine are bani bea şi mãnâncã, iarã cine nu, se uitã şi rabdã”] asociază forme verbale şi pronominale [de persoana I plural şi a III-a singular].

Naraţiunea la persoana a III-a este desfăşurată [cronologic, prin înlănțuirea secvențelor] epice, fiind dramatizată prin dialogul [ce dinamizează întâmplările, susține evoluția acțiunii și caracterizează personajele]. Instanța epică este [omniscientă, omniprezentă, demiurgică], dar deseori îşi părăsește această [mască a obiectivității] și devine un [povestitor] înconjurat de un [auditoriu implicat afectiv/emoțional]. Naratorul nu rămâne indiferent, se miră, se bucură, este insinuant, se face auzit şi simțit mai ales prin [pactul narativ cu cititorul, pus în valoare de formulele mediane de tip captatio benevolentiae].

<b>Personajele</b>
Personajele, instanțe fundamentale în textul epic, [„ființe de hârtie”], aşa cum le defineşte [teoria literară], se grupează în pozitive şi negative, principale şi secundare, [„plate” și “rotunde”], construcția lor realizându-se prin asocierea a două dimensiuni: [una exterioară, alta interioară]. 

Basmul lui Creangă stabileşte numeroase puncte de contact cu realitatea, de aceea [protagonistul, Harap-Alb, nu are multiple însușiri supranaturale, știe doar să comunice cu ființele necuvântătoare]. Paginile basmului îi surprind [triplul statut social], de fiu de crai, de slugă „albă" şi naivă şi în final de împărat. Portretul fizic este schițat din câteva linii, [prin caracterizare directă se precizeazã doar cã are „o înfãţoşare mult mai plãcutã decât spânul”]. 

El este surprins în latura/coordonata sa psihologică, iar frământările lui [determină naşterea unor noi centre de conflict]. Alcătuit din [lumini (calități)] și [umbre (defecte)], Harap-Alb acţionează în [situaţii excepţionale]. [Naivitatea] și deplina încredere în oameni, în ciuda interdicției părintelui său experimentat, se observă în scena a doua. [În ceea ce priveşte numele], eroul îl primeşte acum, în clipa coborârii în fântână, cea în care începe să trăiască provocările și pericolele adevăratei vieți. [Nu va mai fi Harap-Alb atunci când traseul inițiatic se încheie cu recompensarea și nunta]. Astfel, chiar titlul sugerează [caracterul de bildungsroman al operei]. 

Mezinul craiului se defineşte şi indirect prin comportament. Textul ilustrează [sensibilitatea] sa atunci când, copil care îşi iubeşte şi îşi respectă tatăl, fiind jignit [„iese afarã în grãdinã şi începe a plânge în inima sa”]. Tot acum, în grădina palatului părintesc, el se dovedeşte [milos şi plin de compasiune față de Sfânta Duminică], căreia îi dăruieşte un bănuț şi de la care [va primi ajutor divin de trei ori]. 

Din punctul de vedere [moral], el este [altruist şi partener devotat calului înaripat], dobândind toate calitățile necesare pentru a urma la tronul împărăției. Ajutat de fata de care se îndrăgostește, el îşi învinge rivalul și înviază, pentru a putea reveni la statutul de fiu de crai. [De acum, inițiatul, fostul novice cunoaște binele și răul, le-a trait pe amândouă], se va pune necondiționat în [slujba „albului”]. 

Asociat cu [Don Quijote] sau cu [Hamlet], considerat [„erou fermecător”] sau, [dimpotrivă, „simplu”], lipsit de „merite personale", protagonistul s-a schimbat mult [de când a plecat de acasă]. Caracterul [i s-a modelat], a înţeles ce [e mila, a cunoscut iubirea, şi-a probat onoarea]. Spre deosebire de basmul popular, eroul se metamorfozează [„pe scenă”, în faţa cititorilor, confirmând ideea că omul este rezultatul propriilor acte]. 

Relația eroului cu antagonistul basmului, duşmanul declarat al lui Harap-Alb, cu Spânul îi dezvăluie noblețea firii, dar şi temerile/fricile/vulnerabilitățile. Critica modernă afirmă că spânul reprezintă „răul necesar": neiertător, îl supune pe crăițor în permanență unor probe periculoase care produc efectul contrar, transformându-l într-un adevărat erou. În fața calului, tânărul se dovedeşte când neputincios, pesimist, descurajându-se repede în fața probelor tot mai grele date de Spân, când nerăbdător și superficial, pentru că îl loveşte de trei ori cu frâul peste cap când vine să mănânce jăratic. Nici în scena trecerii podului, unde veghează craiul tânărul nu dovedeşte prea mult curaj, fiindcă tot calul îl salvează atunci când se repede asupra „ursului".

<b>Concluzie</b>
În concluzie, basmul acesta definit de George Călinescu drept „o oglindire a vieții în mod fabulos" este un exemplu de creație cultă ce ilustrează viziunea despre lume a autorului, importanța valorilor spirituale în lupta împotriva răului.`;

    let correctAnswers = [];

    function normalize(text) {
        return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
            .replace(/ț/g, "t").replace(/ț/g, "t").replace(/ș/g, "s").replace(/ș/g, "s")
            .toLowerCase().trim();
    }

    function init() {
        const container = document.getElementById('content');
        let i = 0;
        const formattedText = rawText.replace(/\[(.*?)\]/g, (match, word) => {
            correctAnswers.push(word.trim());
            return `<span class="input-number">${i + 1}</span><input type="text" class="blank-input" data-index="${i++}" oninput="updateProgress()">`;
        });
        container.innerHTML = formattedText.replace(/\n/g, '<br>');
        loadSavedProgress();
    }

    function updateProgress() {
        const inputs = document.querySelectorAll('.blank-input');
        let correctCount = 0;
        let answersToSave = [];

        inputs.forEach((input, idx) => {
            answersToSave.push(input.value); 
            let userAns = normalize(input.value);
            let correctAns = normalize(correctAnswers[idx]);
            if (userAns === correctAns && userAns !== "") {
                correctCount++;
                input.style.color = "#10b981";
                input.style.borderBottomColor = "#10b981";
            } else {
                input.style.color = "#4f46e5";
                input.style.borderBottomColor = "#cbd5e1";
            }
        });
        
        sessionStorage.setItem('elev_raspunsuri_t1', JSON.stringify(answersToSave));
        const percent = Math.round((correctCount / correctAnswers.length) * 100);
        const fill = document.getElementById('progress-fill');
        fill.style.width = percent + "%";
        fill.style.backgroundColor = percent < 30 ? "#ef4444" : (percent < 80 ? "#f97316" : "#22c55e");
        document.getElementById('progress-text').innerText = percent + "%";

        database.ref('clasa/' + studentName).set({
            nume: studentName,
            progres: percent,
            scor: correctCount + "/" + correctAnswers.length,
            status: "În lucru",
            raspunsuri: answersToSave,
            test_id: "test1.html",
            test_nume: "Harap-Alb"
        });
    }

    function loadSavedProgress() {
        const saved = sessionStorage.getItem('elev_raspunsuri_t1');
        if (saved) {
            const answers = JSON.parse(saved);
            const inputs = document.querySelectorAll('.blank-input');
            inputs.forEach((input, idx) => { if (answers[idx]) input.value = answers[idx]; });
            updateProgress(); 
        }
    }

    function resetTest() {
        if (confirm("Resetezi tot progresul?")) {
            sessionStorage.removeItem('elev_raspunsuri_t1');
            localStorage.removeItem('elev_nume');
            window.location.href = 'index.html';
        }
    }

    function finalCheck() {
        const inputs = document.querySelectorAll('.blank-input');
        let totalCorrect = 0;
        inputs.forEach((input, idx) => {
            if (normalize(input.value) === normalize(correctAnswers[idx])) totalCorrect++;
        });

        const finalPercent = Math.round((totalCorrect / correctAnswers.length) * 100);
        document.getElementById('score-display').style.display = "block";
        document.getElementById('score-display').innerHTML = `Rezultat final: ${totalCorrect}/${correctAnswers.length}`;

        database.ref('clasa/' + studentName).update({
            status: "Finalizat",
            progres: finalPercent,
            scor: totalCorrect + "/" + correctAnswers.length,
            test_id: "test1.html",
            test_nume: "Harap-Alb"
        });
        alert("Test finalizat! Scorul a fost trimis profesorului.");
    }
</script>
</body>
</html>


