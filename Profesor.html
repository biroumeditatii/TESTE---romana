<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>Panou Profesor - Control & Monitorizare</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #f1f5f9; --card: #ffffff; --primary: #4f46e5; --success: #10b981; --error: #ef4444; --text: #1e293b; --muted: #64748b; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; overflow-x: hidden; }
        .container { max-width: 1000px; margin: 0 auto; }
        .card { background: var(--card); padding: 25px; border-radius: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 30px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #e2e8f0; }
        .btn { padding: 8px 16px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; color: white; transition: 0.2s; }
        .btn-launch { background: var(--success); }
        .btn-stop { background: var(--error); }
        .btn-delete { background: #dc2626; }
        .status-badge { padding: 4px 8px; border-radius: 6px; font-size: 0.8rem; font-weight: bold; background: #e2e8f0; color: #64748b; }
        .active-now { background: #dcfce7; color: #166534; border: 1px solid #10b981; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .student-card { background: white; padding: 20px; border-radius: 18px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 4px solid var(--primary); cursor: pointer; }
        .progress-bg { background: #eee; height: 10px; border-radius: 5px; margin: 12px 0; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.5s; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
        .modal-content { background: white; margin: 8vh auto; padding: 25px; border-radius: 24px; width: 90%; max-width: 450px; max-height: 80vh; overflow-y: auto; }
        .res-item { padding: 10px; border-bottom: 1px solid #f1f5f9; display: flex; flex-direction: column; }
        .res-correct { color: var(--success); font-weight: 700; }
        .res-wrong { color: var(--error); font-weight: 700; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>Panou Profesor</h1>
            <table>
                <tr><td>Test 1: Harap-Alb</td><td><button class="btn btn-launch" onclick="lanseaza('test1.html', 'Harap-Alb')">LANSEAZĂ</button></td></tr>
                <tr><td>Test 2: Moara cu noroc</td><td><button class="btn btn-launch" onclick="lanseaza('test2.html', 'Moara cu noroc')">LANSEAZĂ</button></td></tr>
            </table>
            <div style="margin-top:20px; display:flex; align-items:center; gap:10px;">
                <strong>Stare:</strong> <span id="current-status" class="status-badge">Inactiv</span>
                <button class="btn btn-stop" onclick="opreste()">OPREȘTE</button>
                <button class="btn btn-delete" style="margin-left:auto" onclick="curata()">Ștergere Elevi</button>
            </div>
        </div>
        <div id="students-grid" class="grid"></div>
    </div>

    <div id="resModal" class="modal">
        <div class="modal-content">
            <h2 id="modalName">Rezultate</h2>
            <div id="modalBody"></div>
            <button class="btn" style="background:var(--primary); width:100%; margin-top:20px;" onclick="document.getElementById('resModal').style.display='none'">Închide</button>
        </div>
    </div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyC2xOfKBy7FdA6uIyM0ij5ryHTop0yL3pg",
      databaseURL: "https://bacromana-6f3eb-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "bacromana-6f3eb",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const CHEI = {
        "test1.html": ["modernizarea", "Marilor Clasici", "Titu Maiorescu", "Junimii", "adepți ai clasicismului", "modele", "repere", "Ioan Slavici", "Ion Creangă", "Ion Luca Caragiale", "Mihai Eminescu", "clasei de opere", "narațiunea", "epikos", "Bine-Rãu", "călătorie inițiatică", "adjuvanți", "trei", "nunta", "realist-psihologică", "Alexandru Piru", "bildungsroman", "personalității", "fântânã", "botez", "Eliade", "nonvaloare", "jurământului", "smicelele de măr dulce", "paloș", "titlul", "slugă naivă", "cronotopul", "illo tempore", "III-a", "omniscientă", "narativ", "benevolentiae", "supranaturale", "directă", "Duminică", "Spânul", "necesar"],
        "test2.html": ["modernizarea", "Marilor Clasici", "Titu Maiorescu", "Junimii", "adepți ai clasicismului", "modele", "repere", "repere", "1881", "Novele din popor", "realismului psihologic", "mimesis", "felii de viață", "om-societate", "Ghiță", "alter egoul autorului", "verosimilitate", "Ineu, Arad, Fundureni", "Ana", "Ghiță", "descrierilor", "sobru/ impersonal", "al XIX-lea", "narațiunea", "epikos", "dimensiune medie", "conflict concentrat", "cronologic", "plan narativ", "asupra conturãrii lui Ghiță", "polarizeaza interesul epic", "relația obsesivă", "resorturilor intime", "radiografierea și sondarea psihicului", "supratema degradării umane sub semnul banului", "destinului schimbător", "conflict exterior", "aspru, viclean", "unic stăpân al locurilor", "dârz și motivat", "om rău şi primejdios", "tovarăş", "împrejurări", "șederea la Moara cu noroc depinde numai de bunul său plac", "călău-victimă", "tragedia antică", "jocul porcarului", "mințise", "treapta a degradării morale", "coborârii în infern", "de teamă, de suferință morală", "soțul n-o mai iubește", "să macine familia", "oamenilor lui Lică", "personaj reflector", "a fi dorit prea mult", "fatalității oarbe", "triunghiul de forță", "moartea în lanț", "dintre Bine și Rău", "foc", "oasele albe care ies din cenușa neagră", "morii care „macină” destine", "malefic", "unei noi șanse", "aducător de ghinion", "analitică", "unicizează negativ locul", "hanul lui Sadoveanu", "moralizatoare", "bătrânei", "măsura în toate", "noaptea", "rãsãritul", "au loc în aceste intervale de timp", "persoana a III-a", "cronologic", "înlănțuirea", "dramatizată prin dialogul", "evoluția acțiunii", "personajele", "omniscientă", "cronologia", "17", "„rama” cugetărilor bătrânei", "contrapunctul", "care, la Moara cu noroc începe", "uitat de Divinitate", "psihologic", "Sfântul Gheorghe și până la Paște", "corp sferoid", "oraculară/ premonitorie", "provocarea destinului atrage pedepse grave", "la echilibru", "bătrânei", "moralizatoare", "nu are să iasă bine", "totul dinainte", "încălcă normele morale", "purificator", "epilogul", "pentru un nou început", "instanțe fundamentale", "teoria literară", "„plate” și “rotunde\"", "o dimensiune exterioară, alta interioară", "verosimili", "demonic", "romantica", "polarizează interesul epic", "autorului", "arivistul, dornicul de îmbogățire rapidă", "omul moral, pater familias", "dilematic", "imoral", "Sfântul Gheorghe", "balaur", "sumar", "puternic și umeros ca un taur", "Ana era tânără și frumoasa, (…), iar el însuși, înalt și spătos, o purta ca pe o pană", "comportament", "căutări", "întrebări", "temeri", "oamenii legii", "patima banului", "om e supus", "pluriperspectiva/ tehnica oglinzilor paralele/ tehnica cercurilor concentrice", "responsabil", "subordonat"]
    };

    function normalize(t) { return t.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/ț/g, "t").replace(/ș/g, "s").toLowerCase().trim(); }
    function lanseaza(id, nume) { db.ref('setari').set({ test_activ: true, test_id: id, test_nume: nume }); }
    function opreste() { db.ref('setari/test_activ').set(false); }
    function curata() { if(confirm("Ștergi lista de elevi?")) db.ref('clasa').remove(); }

    db.ref('setari').on('value', snap => {
        const d = snap.val();
        const el = document.getElementById('current-status');
        el.innerText = d.test_activ ? "ACTIV: " + d.test_nume : "INACTIV";
        el.className = d.test_activ ? "status-badge active-now" : "status-badge";
    });

    db.ref('clasa').on('value', snapshot => {
        const grid = document.getElementById('students-grid'); grid.innerHTML = '';
        const data = snapshot.val(); if (!data) return;
        for (let id in data) {
            const s = data[id]; const p = s.progres || 0;
            const color = p < 30 ? "#ef4444" : (p < 85 ? "#f97316" : "#22c55e");
            grid.innerHTML += `<div class="student-card" onclick="veziDetalii('${id}')">
                <strong>${s.nume}</strong> <span style="font-size:0.7rem; float:right">${s.test_nume || ''}</span>
                <div class="progress-bg"><div class="progress-fill" style="width:${p}%; background:${color}"></div></div>
                <div style="font-size:0.8rem; display:flex; justify-content:space-between"><span>${s.scor}</span><span>${p}%</span></div>
            </div>`;
        }
    });

    function veziDetalii(id) {
        db.ref('clasa/' + id).once('value').then(snap => {
            const s = snap.val(); if(!s || !s.raspunsuri) return alert("Nicio dată.");
            const key = CHEI[s.test_id] || CHEI["test1.html"];
            document.getElementById('modalName').innerText = s.nume + " - " + (s.test_nume || "");
            let html = '';
            const ansArr = Array.isArray(s.raspunsuri) ? s.raspunsuri : Object.values(s.raspunsuri);
            ansArr.forEach((r, i) => {
                const ok = normalize(r || "") === normalize(key[i] || "");
                html += `<div class="res-item"><span>${i+1}: <span class="${ok?'res-correct':'res-wrong'}">${r||'(gol)'}</span></span>
                ${!ok ? `<small style="color:gray">Corect: ${key[i]}</small>` : ''}</div>`;
            });
            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('resModal').style.display = 'block';
        });
    }
</script>
</body>
</html>
